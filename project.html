<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Elaina Lin" />


<title>Project</title>

<script src="site_libs/header-attrs-2.7/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Elainalytics</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="project.html">Project</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Project</h1>
<h4 class="author">Elaina Lin</h4>
<h4 class="date">3/16/2021</h4>

</div>


<div id="here-we-will-visualize-the-mask-use-data." class="section level4">
<h4><strong>1. Here, we will visualize the mask use data.</strong></h4>
<p><strong>We are interested in developing a classification of counties into “compliers” and “non-compliers”. A naive approach would be to construct the index assuming an interval ratio scale assumption (i.e. assuming the responses to the questions are numeric and quantifiable as say “A % of time masks are worn”). Refer to <a href="https://en.wikipedia.org/wiki/Level_of_measurement#Ratio_scale" class="uri">https://en.wikipedia.org/wiki/Level_of_measurement#Ratio_scale</a> (Links to an external site.) if you need a refresher on scales. Then the responses can be averaged. Construct this index and plot it. </strong><br />
</p>
<p>To create the index, I will classify Always as 100%, Frequently as 85%, Sometimes as 50%, Rarely as 15%, and Never as 0%. Then I will multiply that with each county’s % of time masks are worn and get the summation. After I get the summation, it will be raised to the power of 5 to indicate the chance that people will be wearing masks in 5 random encounters.</p>
<p>To classify counties into “compliers” and “non-compliers”, I will use a mask-wearing chance of less than 70% as Non-Compliers and 70% or greater as Compliers.</p>
<p>But because based on that classification, it was difficult to see the differences, I created another plot using 60% as the cut-off.</p>
<pre class="r"><code>am_com2 &lt;- am_com2 %&gt;% mutate(fips = str_sub(GEO_ID, -5,-1))

mask_data0 &lt;- mask_use %&gt;% left_join(am_com2, by = c(&quot;COUNTYFP&quot; = &quot;fips&quot;))

mask_data0 %&gt;% select(&quot;COUNTYFP&quot;, &quot;NEVER&quot;, &quot;RARELY&quot;, &quot;SOMETIMES&quot;, &quot;FREQUENTLY&quot;, 
                     &quot;ALWAYS&quot;, &quot;GEO_ID&quot;, &quot;NAME&quot;, &quot;DP02_0079E&quot;, &quot;DP02_0119E&quot; ) -&gt; mask_data

# mask_data %&gt;% select_if(~ ! all(is.na(.))) %&gt;% drop_na() -&gt; mask_data

mask_data %&gt;% mutate(Mask_Chance=((NEVER*0) + (RARELY*.15) + 
                                    (SOMETIMES*.50) + (FREQUENTLY*.85) + 
                                    (ALWAYS*1)) **5) -&gt; mask_data

mask_data %&gt;% mutate(Mask_Use = 
           case_when( `Mask_Chance` &lt; 0.70 ~ &quot;Non-Compliers&quot;,
                      `Mask_Chance` &gt;= 0.70 ~ &quot;Compliers&quot;)) -&gt; 
                                                       mask_data
mask_data %&gt;% mutate(Mask_UseOne = 
           case_when( `Mask_Chance` &lt; 0.70 ~ 0,
                      `Mask_Chance` &gt;= 0.70 ~ 1)) -&gt; mask_data

mask_data %&gt;% mutate(Mask_Use60 = 
           case_when( `Mask_Chance` &lt; 0.60 ~ &quot;Non-Compliers&quot;,
                      `Mask_Chance` &gt;= 0.60 ~ &quot;Compliers&quot;)) -&gt; 
                                                       mask_data</code></pre>
<pre class="r"><code>mask_data2 &lt;- mask_data %&gt;% select(COUNTYFP, Mask_Chance,
                                   NEVER, RARELY, SOMETIMES, FREQUENTLY, ALWAYS, 
                                   GEO_ID, NAME, 
                                   DP02_0079E, DP02_0119E,
                                   Mask_Use, Mask_Use60)

mask_map_data &lt;- counties %&gt;% full_join(mask_data2, 
                                        by = c(&quot;county_fips&quot;=&quot;COUNTYFP&quot;))


mask_map_data %&gt;%
  ggplot(aes(long, lat, group = group, fill = Mask_Use)) +
  geom_polygon(color = NA) +
  coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45)</code></pre>
<p><img src="project_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code>mask_map_data %&gt;%
  ggplot(aes(long, lat, group = group, fill = Mask_Use60)) +
  geom_polygon(color = NA) +
  coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45)</code></pre>
<p><img src="project_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
</div>
<div id="read-the-following-article-httpswww.nytimes.cominteractive20200717upshotcoronavirus-face-mask-map.html-links-to-an-external-site." class="section level4">
<h4><strong>2. Read the following article: <a href="https://www.nytimes.com/interactive/2020/07/17/upshot/coronavirus-face-mask-map.html" class="uri">https://www.nytimes.com/interactive/2020/07/17/upshot/coronavirus-face-mask-map.html</a> (Links to an external site.)</strong></h4>
<p><strong>Reproduce the calculation discussed in the article and plot the results. Aim to reproduce the graph.</strong><br />
</p>
<p>I classify Always as 100%, Frequently as 80%, Sometimes as 50%, Rarely as 20%, and Never as 0%. Then I will multiply that with each county’s % of time masks are worn and get the summation. Then I raised it to the power of 5 to indicate the chance that people will be wearing masks in 5 random encounters.</p>
<pre class="r"><code>mask_data %&gt;% mutate(Mask_Chance=((NEVER*0) + (RARELY*.20) + 
                                    (SOMETIMES*.50) + (FREQUENTLY*.80) + 
                                    (ALWAYS*1)) **5) -&gt; mask_data

mask_map_data %&gt;% 
  ggplot(aes(long, lat, group = group, fill = Mask_Chance)) +
  geom_polygon(color = NA, size=0.15) +
  geom_polygon(data = states, mapping = aes(long, lat, group = group),
               fill = NA, color = &quot;#ffffff&quot;) +
  scale_fill_gradientn(colours = c(&quot;#FFF8F5&quot;, &quot;#FAA3BC&quot;,&quot;#C93A9A&quot;,&quot;#752685&quot;), 
                       guide = guide_colorbar(title.position = &quot;top&quot;)) +
  coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45) +
  labs(title=&quot;A Detailed Map of Who Is Wearing Masks in the U.S.&quot;,
       fill = &quot;Chance all five people are wearing masks in five random encounters&quot;) +
  theme(plot.title = element_text(hjust = 0.5, size=18, 
                                  face=&quot;bold&quot;, family=&quot;serif&quot;), 
        legend.title = element_text(size=10, face=&quot;bold&quot;),
        legend.key.width = unit(.5, &quot;in&quot;), 
        legend.position=&quot;top&quot;) +
  scale_color_manual(labels = c(&quot;20%&quot;, &quot;40%&quot;, &quot;60%&quot;,&quot;80%&quot;, &quot;100%&quot;))</code></pre>
<p><img src="project_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="compare-approach-in-1-and-2.-what-are-the-advantages-and-disadvantages-of-it" class="section level4">
<h4><strong>3. Compare approach in 1 and 2. What are the advantages and disadvantages of it?</strong><br />
</h4>
<p>In approach #1, an advantage is that it clearly shows at first glance which counties are compliers or not. However, a downside of approach #1 is that it classifies the counties into 2 larger groups which might make the data less meaningful considering that most of the U.S. seems to be noncompliers (based on the threshold of 70% used). Knowing the slight differences can be more helpful in understanding the discrepancies between mask usage between counties, which is illustrated better by approach #2 with the gradient colors depicting different levels of mask compliance. However, the gradient colors and varying levels also make it less clear which counties are strictly compliers or not since it corresponds with different levels of mask compliance. I would say that the approach that would be most useful and beneficial depends on the aim of the analysis and investigation. Approach #2 may be more useful in understanding how mask usage breaks down by each county because the scale is more detailed and offers a more thorough understanding of mask compliance in the US. Approach #1 can be useful if one wants to have a more straightforward black and white answer for their analysis.</p>
</div>
<div id="ideally-we-would-want-to-not-make-the-ratio-assumption-yet-still-classify-the-counties-somehow.-we-can-treat-each-response-category-as-its-own-variable-and-apply-clustering-methods-on-the-data-to-identify-the-2-clusters.-do-hierarchical-clustering-using-all-three-discussed-linkage-methods-then-repeat-with-k-means-clustering.-plot-the-4-maps.-compare-the-results." class="section level4">
<h4><strong>4. Ideally we would want to NOT make the Ratio assumption, yet still classify the counties somehow. We can treat each response category as its own variable and apply clustering methods on the data to identify the 2 clusters. Do hierarchical clustering using all three discussed linkage methods, then repeat with k-means clustering. Plot the 4 maps. Compare the results.</strong><br />
</h4>
<p>Here, I created the cluster analysis by only using the variables NEVER, RARELY, SOMETIMES, FREQUENTLY, and ALWAYS. For the 2 clusters in hierarchical clustering, Cluster 1 is “Complier” and Cluster 2 is “Non-Complier.” I then did hierarchical clustering using the single, average, and complete methods. Looking at the map plots, it looks like “complete” method provides a better overview of the mask compliance state in the US, with Cluster 2 and Cluster 2 being more fairly distributed and it looks like the entire country has a similar share of “Complier” and “Non-Compliers”, with slightly more “Non-Compliers” . On the other hand, “single” method is less clear and does not provide much insight for mask compliance. Likewise, “average” methods seems to be not quite informative as well. It indicates most of the country are “Non-Compliers.” Interestingly, it seems that from the “single” method, a particular county in Utah stands out in being non-compliant.</p>
<p>In the k-means clustering, the plot has Cluster 1 as “Non-Compliers” and Cluster 2 as “Compliers”. The plot seems to be very similar to complete method for hierarhical clustering. What’s interesting in the maps is that it seems that central America is mostly non-compliant. This somewhat makes sense because west and east coast areas may be more compliant due to having more international travellers in that area hence people may have a culture of being more wary and careful.</p>
<pre class="r"><code>mask_use %&gt;% select(NEVER, RARELY, SOMETIMES, FREQUENTLY, ALWAYS) -&gt; mask_use2

dist_mask &lt;- dist(mask_use2, method =&quot;euclidean&quot;)

plot(hclust(dist_mask, method = &#39;single&#39;))</code></pre>
<p><img src="project_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code>plot(hclust(dist_mask, method = &#39;average&#39;))</code></pre>
<p><img src="project_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<pre class="r"><code>plot(hclust(dist_mask, method = &#39;complete&#39;))</code></pre>
<p><img src="project_files/figure-html/unnamed-chunk-4-3.png" width="672" /></p>
<pre class="r"><code>mask_clust_complete &lt;- hclust(dist_mask, method = &#39;complete&#39;)
mask_clusters_complete &lt;- cutree(mask_clust_complete, k = 2)</code></pre>
<pre class="r"><code>##single method

mask_clust_single &lt;- hclust(dist_mask, method = &#39;single&#39;)
mask_clusters_single &lt;- cutree(mask_clust_single, k = 2)

mask_use2 %&gt;% mutate(cluster = mask_clusters_single) -&gt; mask_use_single

mask_use_single %&gt;% 
  group_by(cluster) %&gt;% 
  summarise_all(funs(mean(.,  na.rm = T)))</code></pre>
<pre><code>## Warning: `funs()` is deprecated as of dplyr 0.8.0.
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## # A tibble: 2 x 6
##   cluster  NEVER RARELY SOMETIMES FREQUENTLY ALWAYS
##     &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;
## 1       1 0.0798 0.0829     0.121      0.208  0.508
## 2       2 0.432  0.023      0.088      0.171  0.286</code></pre>
<pre class="r"><code>single_mask_clusterdata &lt;- mask_map_data %&gt;% 
  left_join(mask_use_single, by = c(&quot;NEVER&quot; = &quot;NEVER&quot;, &quot;RARELY&quot; = &quot;RARELY&quot;, 
                                    &quot;SOMETIMES&quot; = &quot;SOMETIMES&quot;, 
                                    &quot;FREQUENTLY&quot; = &quot;FREQUENTLY&quot;, 
                                    &quot;ALWAYS&quot; = &quot;ALWAYS&quot;))

single_mask_clusterdata %&gt;% 
  ggplot(aes(long, lat, group = group, fill = cluster)) +
  geom_polygon(color = NA, size=0.15) +
  geom_polygon(data = states, mapping = aes(long, lat, group = group),
               fill = NA, color = &quot;#ffffff&quot;) +
  coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45) +
  labs(title=&quot;Cluster Analysis of Counties Wearing Masks&quot;,
       fill = &quot;Clusters&quot;) +
  theme(plot.title = element_text(hjust = 0.5, size=18, 
                                  face=&quot;bold&quot;, family=&quot;serif&quot;), 
        legend.title = element_text(size=10, face=&quot;bold&quot;),
        legend.key.width = unit(.5, &quot;in&quot;), 
        legend.position=&quot;right&quot;)</code></pre>
<p><img src="project_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre class="r"><code>##average method

mask_clust_average &lt;- hclust(dist_mask, method = &#39;average&#39;)
mask_clusters_average &lt;- cutree(mask_clust_average, k = 2)

mask_use2 %&gt;% mutate(cluster = mask_clusters_average) -&gt; mask_use_avge

mask_use_avge %&gt;% 
  group_by(cluster) %&gt;% 
  summarise_all(funs(mean(.,  na.rm = T)))</code></pre>
<pre><code>## # A tibble: 2 x 6
##   cluster  NEVER RARELY SOMETIMES FREQUENTLY ALWAYS
##     &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;
## 1       1 0.0794 0.0828     0.121      0.208  0.509
## 2       2 0.236  0.131      0.254      0.180  0.199</code></pre>
<pre class="r"><code>average_mask_clusterdata &lt;- mask_map_data %&gt;% 
  left_join(mask_use_avge, by = c(&quot;NEVER&quot; = &quot;NEVER&quot;, &quot;RARELY&quot; = &quot;RARELY&quot;, 
                                  &quot;SOMETIMES&quot; = &quot;SOMETIMES&quot;, 
                                  &quot;FREQUENTLY&quot; = &quot;FREQUENTLY&quot;, 
                                  &quot;ALWAYS&quot; = &quot;ALWAYS&quot;))

average_mask_clusterdata %&gt;% 
  ggplot(aes(long, lat, group = group, fill = cluster)) +
  geom_polygon(color = NA, size=0.15) +
  geom_polygon(data = states, mapping = aes(long, lat, group = group),
               fill = NA, color = &quot;#ffffff&quot;) +
  coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45) +
  labs(title=&quot;Cluster Analysis of Counties Wearing Masks&quot;,
       fill = &quot;Clusters&quot;) +
  theme(plot.title = element_text(hjust = 0.5, size=18, 
                                  face=&quot;bold&quot;, family=&quot;serif&quot;), 
        legend.title = element_text(size=10, face=&quot;bold&quot;),
        legend.key.width = unit(.5, &quot;in&quot;), 
        legend.position=&quot;right&quot;)</code></pre>
<p><img src="project_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>#complete method

mask_clust_complete &lt;- hclust(dist_mask, method = &#39;complete&#39;)
mask_clusters_complete &lt;- cutree(mask_clust_complete, k = 2)

mask_use2 %&gt;% mutate(cluster = mask_clusters_complete) -&gt; mask_use_comp

mask_use_comp %&gt;% 
  group_by(cluster) %&gt;% 
  summarise_all(funs(mean(.,  na.rm = T)))</code></pre>
<pre><code>## # A tibble: 2 x 6
##   cluster  NEVER RARELY SOMETIMES FREQUENTLY ALWAYS
##     &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;
## 1       1 0.0630 0.0660     0.106      0.200  0.566
## 2       2 0.135  0.138      0.172      0.235  0.320</code></pre>
<pre class="r"><code>comp_mask_clusterdata &lt;- mask_map_data %&gt;% 
  left_join(mask_use_comp, by = c(&quot;NEVER&quot; = &quot;NEVER&quot;, &quot;RARELY&quot; = &quot;RARELY&quot;, 
                                  &quot;SOMETIMES&quot; = &quot;SOMETIMES&quot;, 
                                  &quot;FREQUENTLY&quot; = &quot;FREQUENTLY&quot;, 
                                  &quot;ALWAYS&quot; = &quot;ALWAYS&quot;))

comp_mask_clusterdata %&gt;% 
  ggplot(aes(long, lat, group = group, fill = cluster)) +
  geom_polygon(color = NA, size=0.15) +
  geom_polygon(data = states, mapping = aes(long, lat, group = group),
               fill = NA, color = &quot;#ffffff&quot;) +
  coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45) +
  labs(title=&quot;Cluster Analysis of Counties Wearing Masks&quot;,
       fill = &quot;Clusters&quot;) +
  theme(plot.title = element_text(hjust = 0.5, size=18, 
                                  face=&quot;bold&quot;, family=&quot;serif&quot;), 
        legend.title = element_text(size=10, face=&quot;bold&quot;),
        legend.key.width = unit(.5, &quot;in&quot;), 
        legend.position=&quot;right&quot;)</code></pre>
<p><img src="project_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="lets-now-do-k-means-clustering" class="section level2">
<h2>Let’s now do K-means clustering</h2>
<pre class="r"><code># k means clustering

set.seed(123)
km.out=kmeans(mask_use2,2,nstart=20)
km.out$cluster</code></pre>
<pre><code>##    [1] 1 1 1 2 1 1 1 1 2 1 2 2 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 2 2 1 1 1 2 2 1 1 2 1 1 2 2 1 1 1 1 1 1 1 2 2 1 1 2
##   [58] 1 2 2 1 1 2 1 1 1 1 2 2 2 1 2 2 1 1 1 1 1 2 1 2 1 2 2 1 1 1 1 1 1 1 1 2 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
##  [115] 2 1 1 1 2 2 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 2 2 2 1 1 1 2 1 1 1 1 2 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2
##  [172] 1 1 2 1 2 1 1 1 1 1 2 2 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
##  [229] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 1 2 1 1 2 2 2 2 1 2 2 2 2 1 1 2 2 2 2 1 2 2 2 2 2 2 1 2 2 2 1 1 2 2 2 2 1 1 1 1
##  [286] 1 2 1 1 2 1 2 1 2 1 2 1 1 1 1 2 2 1 2 2 1 2 1 2 2 2 2 2 2 2 2 2 2 2 2 2 1 2 1 2 2 1 2 2 1 2 1 2 1 2 2 2 1 2 1 2 1
##  [343] 1 1 2 2 2 2 2 2 2 2 1 2 2 2 2 1 1 2 2 2 2 2 1 1 2 2 2 2 2 2 2 2 2 2 1 2 2 2 1 1 1 2 1 1 2 1 1 1 2 1 1 2 1 1 1 1 1
##  [400] 1 1 2 1 1 2 2 1 1 1 1 1 2 2 1 2 2 2 2 2 2 1 1 2 1 1 1 2 1 2 1 2 1 2 2 2 1 1 1 1 1 1 2 1 1 2 1 2 2 2 1 1 1 2 2 1 2
##  [457] 2 1 2 1 1 2 2 1 1 2 1 1 1 1 1 1 1 1 2 2 1 2 1 1 1 1 2 1 1 1 2 2 1 1 2 1 2 1 2 2 1 2 2 1 2 1 2 1 2 1 2 2 2 1 1 1 1
##  [514] 1 1 2 1 2 1 1 1 2 2 1 1 2 1 1 2 2 2 1 1 1 2 1 2 2 2 1 1 1 2 2 2 2 2 2 2 2 2 2 1 1 1 2 1 1 1 1 1 2 1 2 1 1 1 1 1 1
##  [571] 2 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 1 2 1 2 1 2 2 1 1 2 1 2 1 1 2 1 2 2 1 1 1 1 2 1 1 1 1 2
##  [628] 1 1 1 2 2 1 1 1 1 2 1 1 2 2 2 1 2 2 1 2 1 2 2 2 2 2 2 2 1 2 1 1 2 2 2 2 2 1 2 2 1 2 1 1 1 2 1 1 2 2 1 2 1 1 1 2 2
##  [685] 2 1 1 1 2 1 1 1 2 2 1 2 1 1 1 1 1 1 1 2 1 1 1 1 1 1 2 1 1 2 1 2 2 1 1 1 2 1 1 1 2 2 1 1 2 1 1 1 1 1 1 1 1 2 1 1 1
##  [742] 2 1 1 2 2 1 2 1 2 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 2 1 1 2 1 2 1 1 1 1 2 2 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 2 1
##  [799] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 1 1 1 1 2 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 1 1 1 1 1 1 1
##  [856] 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1
##  [913] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 1 2 1 1 1 1 1 2 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 1 1 1 2
##  [970] 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 2 1 1 1 1 2 1 1
##  [ reached getOption(&quot;max.print&quot;) -- omitted 2142 entries ]</code></pre>
<pre class="r"><code>km.out$tot.withinss</code></pre>
<pre><code>## [1] 54.14113</code></pre>
<pre class="r"><code>mask_use2 %&gt;% mutate(cluster = km.out$cluster) -&gt; mask_use_kmeans

mask_use_kmeans %&gt;% 
  group_by(cluster) %&gt;% 
  summarise_all(funs(mean(.,  na.rm = T)))</code></pre>
<pre><code>## # A tibble: 2 x 6
##   cluster  NEVER RARELY SOMETIMES FREQUENTLY ALWAYS
##     &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;
## 1       1 0.110  0.112     0.150       0.232  0.396
## 2       2 0.0418 0.0470    0.0848      0.177  0.649</code></pre>
<pre class="r"><code>comp_mask_clusterdata &lt;- mask_map_data %&gt;% 
  left_join(mask_use_kmeans, by = c(&quot;NEVER&quot; = &quot;NEVER&quot;, &quot;RARELY&quot; = &quot;RARELY&quot;, 
                                    &quot;SOMETIMES&quot; = &quot;SOMETIMES&quot;, 
                                    &quot;FREQUENTLY&quot; = &quot;FREQUENTLY&quot;, 
                                    &quot;ALWAYS&quot; = &quot;ALWAYS&quot;))

comp_mask_clusterdata  %&gt;% 
  ggplot(aes(long, lat, group = group, fill = cluster)) +
  geom_polygon(color = NA, size=0.15) +
  geom_polygon(data = states, mapping = aes(long, lat, group = group),
               fill = NA, color = &quot;#ffffff&quot;) +
  coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45) +
  labs(title=&quot;Cluster Analysis of Counties Wearing Masks&quot;,
       fill = &quot;Clusters&quot;) +
  theme(plot.title = element_text(hjust = 0.5, size=18, 
                                  face=&quot;bold&quot;, family=&quot;serif&quot;), 
        legend.title = element_text(size=10, face=&quot;bold&quot;),
        legend.key.width = unit(.5, &quot;in&quot;), 
        legend.position=&quot;right&quot;)</code></pre>
<p><img src="project_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div id="what-counties-appear-to-be-more-compliant-and-what-counties-appear-to-be-less-compliant-choose-one-variable-from-acs-that-is-available-for-all-or-most-counties-population-size-density-average-age-income-etc-construct-a-classification-algorithm-tree-or-regression-predicting-compliance-using-as-a-function-of-this-variable-and-discuss-the-metrics-of-performance-using-confusion-matrices." class="section level4">
<h4><strong>5. What counties appear to be more compliant and what counties appear to be less compliant? Choose one variable from ACS that is available for all or most counties (population size, density, average age, income etc), construct a classification algorithm (tree or regression) predicting compliance using as a function of this variable and discuss the metrics of performance using confusion matrices).</strong><br />
</h4>
<p>Here, I used the threshold as lower than 60% as “Non-Compliant” state and greater than or equal to 60% as “Compliant” state. The variable I chose is the family household income “B19126_001” to see if counties that had more households with higher income may be associated with mask use compliance. I constructed the classification algorithm, the decision tree. Looking at the confusion matrix, it seems that this variable is not very predictive of whether the counties are compliant or not. The sensitivity rate is 67.2%, so it may have some false-negative results. The specificity is 71.8% and may have false-positive results. Confusion matrix indicates that decision tree model has 259 correct predictions and 109 incorrect predictions.</p>
<p>It looks like of counties in the entire sample, 68% of counties are “Compliant” if they have a family household income of less than $86,000. 40% are counties that have a compliant probability of 48% if the households make more than 86,000. 60% are counties making less than 86,000, with 83% of them non-compliant.</p>
<pre class="r"><code>library(caret)</code></pre>
<pre><code>## Warning: package &#39;caret&#39; was built under R version 4.0.3</code></pre>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## 
## Attaching package: &#39;caret&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     lift</code></pre>
<pre class="r"><code>library(rpart.plot)</code></pre>
<pre><code>## Warning: package &#39;rpart.plot&#39; was built under R version 4.0.3</code></pre>
<pre><code>## Loading required package: rpart</code></pre>
<pre class="r"><code>library(Metrics)</code></pre>
<pre><code>## Warning: package &#39;Metrics&#39; was built under R version 4.0.3</code></pre>
<pre><code>## 
## Attaching package: &#39;Metrics&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:caret&#39;:
## 
##     precision, recall</code></pre>
<pre class="r"><code>library(tidycensus)</code></pre>
<pre><code>## Warning: package &#39;tidycensus&#39; was built under R version 4.0.3</code></pre>
<pre class="r"><code>set.seed(123)
mask_data %&gt;% mutate(Mask_Use0 = 
           case_when( `Mask_Chance` &lt; 0.60 ~ &quot;Non-Compliers&quot;,
                      `Mask_Chance` &gt;= 0.60 ~ &quot;Compliers&quot;)) -&gt; 
                                                       mask_data 
census &lt;- get_acs(geography = &quot;county&quot;,
                  variables = c( fam_income =&quot;B19126_001&quot;),
                   year = 2019 )</code></pre>
<pre><code>## Getting data from the 2015-2019 5-year ACS</code></pre>
<pre class="r"><code>mask_data %&gt;% select_if(~ ! all(is.na(.))) %&gt;% drop_na() -&gt; mask_model0

mask_model &lt;- mask_model0 %&gt;%  left_join(census, by = c(&quot;NAME&quot; = &quot;NAME&quot;))

mask_tree &lt;- rpart(Mask_Use0 ~ estimate, data = mask_model, 
                   method=&quot;class&quot;, 
                   control = rpart.control(cp=0.05))

rpart.plot(mask_tree, yesno=2, type =1)</code></pre>
<p><img src="project_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>confusionMatrix(predict(mask_tree, mask_model, type=&quot;class&quot;),
                as.factor(mask_model$Mask_Use0))</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##                Reference
## Prediction      Compliers Non-Compliers
##   Compliers            78            71
##   Non-Compliers        38           181
##                                         
##                Accuracy : 0.7038        
##                  95% CI : (0.6543, 0.75)
##     No Information Rate : 0.6848        
##     P-Value [Acc &gt; NIR] : 0.233922      
##                                         
##                   Kappa : 0.3628        
##                                         
##  Mcnemar&#39;s Test P-Value : 0.002176      
##                                         
##             Sensitivity : 0.6724        
##             Specificity : 0.7183        
##          Pos Pred Value : 0.5235        
##          Neg Pred Value : 0.8265        
##              Prevalence : 0.3152        
##          Detection Rate : 0.2120        
##    Detection Prevalence : 0.4049        
##       Balanced Accuracy : 0.6953        
##                                         
##        &#39;Positive&#39; Class : Compliers     
## </code></pre>
<p>“Estimates from The New York Times, based on roughly 250,000 interviews conducted by Dynata from July 2 to July 14.”</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
